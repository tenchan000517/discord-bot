# 新規DiscordサーバーへのBot追加手順

## 1. Bot招待URLの取得

1. [Discord Developer Portal](https://discord.com/developers/applications) にアクセス
   - 使用中のDiscordアカウントでログイン
   - 既存のBot Applicationを選択

2. OAuth2 URLの生成
   - 左メニューから「OAuth2」を選択
   - 「URL Generator」をクリック
   - 「Scopes」で以下を選択：
     - `bot`
     - `applications.commands`
   - 「Bot Permissions」で必要な権限を選択：
     - `Administrator`（または必要な個別の権限）
   - 生成されたURLをコピー

## 2. Botの招待

1. コピーしたURLをブラウザで開く

2. 追加したいサーバーを選択
   - 「サーバーを選択」ドロップダウンから対象のサーバーを選択
   - サーバーの管理者権限が必要です

3. 認証を確認
   - 要求された権限を確認
   - 「認証する」をクリック

## 3. サーバーでの初期設定

1. サーバー管理者として以下のコマンドを実行：
```
!gacha_setup
```

2. 以下の項目を確認：
   - ガチャパネルが正しく表示されるか
   - ボタンが機能するか
   - ポイントシステムが正常に動作するか
   - ロールが自動で作成されているか
   - ガチャが実行できるか

## 4. データベースの確認（必要な場合）

1. ローカルのVS Codeターミナルでサーバーに接続：
```bash
ssh -i "C:/discord-gacha-bot/discord-bot-key.pem" ec2-user@18.181.82.180
```

2. EC2サーバー側で確認：
```bash
cd ~/discord-bot
source venv/bin/activate
python
```

3. Pythonシェル内でデータベースを確認：
```python
from utils.aws_database import AWSDatabase
db = AWSDatabase()

# 新しいサーバーの設定を確認
server_id = "新しいサーバーのID"  # サーバーIDを指定
settings = db.get_server_settings(server_id)
print("Server Settings:", settings)
```

## 5. 動作確認項目

1. 基本機能の確認
   - ガチャが実行できるか
   - ポイントが正しく加算されるか
   - 1日1回の制限が機能しているか

2. ロールの確認
   - ポイントに応じてロールが付与されるか
   - ロールの権限が適切か

3. データベースの確認
   - ユーザーデータが正しく保存されているか
   - サーバー設定が正しく保存されているか
   - ガチャ履歴が記録されているか

## 補足：サーバーIDの確認方法

1. Discordの開発者モードを有効にする
   - Discordの設定 → 詳細設定
   - 開発者モードをオン

2. サーバーIDの取得
   - サーバー名を右クリック
   - 「IDをコピー」を選択

## トラブルシューティング

1. Botが応答しない場合
   - EC2上でのログを確認：
   ```bash
   tail -f /var/log/discord-bot/discord.log
   ```

2. データベースエラーの場合
   - DynamoDBのテーブルを確認
   - サーバー設定が正しく初期化されているか確認

3. 権限エラーの場合
   - Botの権限設定を確認
   - サーバーでの役割の階層を確認